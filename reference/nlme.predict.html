<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Prediction tool for nlme object — nlme.predict • qpToolkit</title>

<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script>

<!-- sticky kit -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>



<meta property="og:title" content="Prediction tool for nlme object — nlme.predict" />

<meta property="og:description" content="Predict residuals, partial residuals or uncertainty predictions for an nlme.object. This function will also take different data set (argument newdata) to simulate out of the box although the nlme object does require the predictors, independent variable, and the grouping variable to be present." />
<meta name="twitter:card" content="summary" />



<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">qpToolkit</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.7</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/ASeriesofqpToolkitVignettes.html">qpToolkit Vignettes</a>
    </li>
    <li>
      <a href="../articles/CreateDemographicsTable.html">Creating a Demographics Table</a>
    </li>
    <li>
      <a href="../articles/ExamplesnlmexxxFunctionsqpToolkit.html">Examples_nlme_xxx_Functions_qpToolkit</a>
    </li>
    <li>
      <a href="../articles/ExamplesnmxxxFunctionsqpToolkit.html">Examples nm_xxx Functions qpToolkit</a>
    </li>
    <li>
      <a href="../articles/RunaNONMEMAnalysis.html">Run a NONMEM Analysis</a>
    </li>
    <li>
      <a href="../articles/qPColorPalette.html">qPharmetra Color Palette</a>
    </li>
    <li>
      <a href="../articles/qpToolkitGeneralPurposeFunctions.html">qpToolkit General Purpose Functions</a>
    </li>
    <li>
      <a href="../articles/qpToolkitPKPDpredictionFunctions.html">qpToolkit PKPD Prediction Functions</a>
    </li>
    <li>
      <a href="../articles/qpToolkitPlottingTips.html">qpToolkit General Purpose Functions</a>
    </li>
    <li>
      <a href="../articles/qpToolkitgetFunctions.html">qpToolkit get_xxx Functions</a>
    </li>
  </ul>
</li>
      </ul>
      
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Prediction tool for nlme object</h1>
    
    <div class="hidden name"><code>nlme.predict.Rd</code></div>
    </div>

    <div class="ref-description">
    
    <p>Predict residuals, partial residuals or uncertainty predictions for an nlme.object. This function will also take different data set (argument <code>newdata</code>) to simulate out of the box although the nlme object does require the predictors, independent variable, and the grouping variable to be present.</p>
    
    </div>

    <pre class="usage"><span class='co'># S3 method for predict</span>
<span class='fu'>nlme</span>(<span class='no'>func</span>, <span class='no'>object</span>, <span class='kw'>newdata</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='no'>subset.modeldata</span>,
  <span class='kw'>xrange</span> <span class='kw'>=</span> <span class='fl'>50</span>, <span class='kw'>nx</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>level</span> <span class='kw'>=</span> <span class='fl'>1</span>, <span class='kw'>method</span> <span class='kw'>=</span> <span class='st'>"partial.residuals"</span>,
  <span class='kw'>use.etas</span> <span class='kw'>=</span> <span class='st'>"estimated"</span>, <span class='kw'>uncertainty</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>,
  <span class='kw'>reference.subset</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>nrep</span> <span class='kw'>=</span> <span class='fl'>20</span>)</pre>
    
    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>func</th>
      <td><p>the function to evaluate over the model, e.g. <code>effect ~ time | treatment</code> the variables in <code>func</code> need to be evaluable in <code>getData(object)</code> and  <code>getCovariateFormula(object)</code></p></td>
    </tr>
    <tr>
      <th>object</th>
      <td><p>nlme object</p></td>
    </tr>
    <tr>
      <th>newdata</th>
      <td><p>a new data set, requiring the predictors, independent variable, and the grouping variable to be present.</p></td>
    </tr>
    <tr>
      <th>subset.modeldata</th>
      <td><p>character string to be evaluated over the data in order to subset the predictions and observations (e.g. "DOSE == 100")</p></td>
    </tr>
    <tr>
      <th>xrange</th>
      <td><p>number of equal-space independent varaible (x) default value = 50,</p></td>
    </tr>
    <tr>
      <th>nx</th>
      <td><p>number of bins of independenet ,</p></td>
    </tr>
    <tr>
      <th>level</th>
      <td><p>grouping level of the nlme object to create predictions at (defaults to 1, the highest grouping level)</p></td>
    </tr>
    <tr>
      <th>method</th>
      <td><p>Either one of 'partial.residuals' (default), 'prediction' (the traditional <code><a href='https://www.rdocumentation.org/packages/stats/topics/predict'>predict(nlme.object)</a></code>), or 'residuals' (doing <code><a href='https://www.rdocumentation.org/packages/graphics/topics/plot'>plot(resid ~ any.column)</a></code>.</p></td>
    </tr>
    <tr>
      <th>use.etas</th>
      <td><p>'estimated' (default) which uses the estimated deviations for each group level) or 'sampled' in case one wants to sample using the estimate of random variability</p></td>
    </tr>
    <tr>
      <th>uncertainty</th>
      <td><p>logical (defaults to F) determining if simulation should be done across uncertainty</p></td>
    </tr>
    <tr>
      <th>reference.subset</th>
      <td><p>character string to be evaluated over the data in order to subset the predictions and observations in ordeer to create a 'change from' perspective plot (works for method 'prediction' and 'partial residuals')</p></td>
    </tr>
    <tr>
      <th>nrep</th>
      <td><p>number of replicates to simulate. Defaults to 20.</p></td>
    </tr>
    </table>
    
    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>a graph or a multi-level list with observed and predicted output</p>
    

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'>
<span class='no'>pkpdData</span> <span class='kw'>=</span> <span class='fu'>example.pkpdData</span>()
<span class='no'>EFF.1comp.1abs</span> <span class='kw'>=</span> <span class='kw'>function</span>(<span class='no'>dose</span>, <span class='no'>tob</span>, <span class='no'>cl</span>, <span class='no'>v</span>, <span class='no'>ka</span>, <span class='no'>keo</span>)
{
  <span class='co'># Effect-site concentration for 1-compartment model, 1st-order absorption</span>

  <span class='no'>kel</span> <span class='kw'>=</span> <span class='no'>cl</span> / <span class='no'>v</span>

  <span class='co'># Define coefficients</span>
  <span class='no'>A</span> <span class='kw'>=</span> <span class='fl'>1</span>/(<span class='no'>kel</span>-<span class='no'>ka</span>) / (<span class='no'>keo</span>-<span class='no'>ka</span>)
  <span class='no'>B</span> <span class='kw'>=</span> <span class='fl'>1</span>/(<span class='no'>ka</span>-<span class='no'>kel</span>) / (<span class='no'>keo</span>-<span class='no'>kel</span>)
  <span class='no'>C</span> <span class='kw'>=</span> <span class='fl'>1</span>/(<span class='no'>ka</span>-<span class='no'>keo</span>) / (<span class='no'>kel</span>-<span class='no'>keo</span>)

  <span class='co'># Return effect-site concentration</span>
  <span class='no'>dose</span>*<span class='no'>ka</span>*<span class='no'>keo</span>/<span class='no'>v</span> * (<span class='no'>A</span>*<span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/Log'>exp</a></span>(-<span class='no'>ka</span>*<span class='no'>tob</span>) + <span class='no'>B</span>*<span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/Log'>exp</a></span>(-<span class='no'>kel</span>*<span class='no'>tob</span>) + <span class='no'>C</span>*<span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/Log'>exp</a></span>(-<span class='no'>keo</span>*<span class='no'>tob</span>))
}
<span class='no'>fit.PD004.nlme</span> <span class='kw'>=</span> <span class='fu'>nlme.run</span>(<span class='kw'>model</span> <span class='kw'>=</span> <span class='no'>value</span> ~ <span class='no'>base</span> + <span class='fu'>EFF.1comp.1abs</span>(<span class='no'>dose</span>, <span class='no'>time</span>, <span class='no'>cl</span> * <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/Log'>exp</a></span>(<span class='no'>cl.eta</span>), <span class='no'>v</span>, <span class='no'>ka</span>, <span class='no'>keo</span>),
                          <span class='kw'>data</span> <span class='kw'>=</span> <span class='no'>pkpdData</span>[<span class='no'>pkpdData</span>$<span class='no'>type</span> <span class='kw'>==</span> <span class='st'>"PD"</span> <span class='kw'>&amp;</span> <span class='no'>pkpdData</span>$<span class='no'>dose</span> <span class='kw'>&gt;</span> <span class='fl'>0</span> <span class='kw'>&amp;</span> <span class='no'>pkpdData</span>$<span class='no'>value</span> <span class='kw'>&gt;</span> <span class='fl'>0.5</span>, ],
                          <span class='kw'>fixed</span> <span class='kw'>=</span> <span class='no'>base</span> + <span class='no'>cl</span> + <span class='no'>v</span> + <span class='no'>ka</span> + <span class='no'>keo</span> ~ <span class='fl'>1</span>,
                          <span class='kw'>random</span> <span class='kw'>=</span> <span class='no'>cl.eta</span> ~ <span class='fl'>1</span>,
                          <span class='kw'>groups</span> <span class='kw'>=</span> ~ <span class='no'>id</span>,
                          <span class='kw'>start</span> <span class='kw'>=</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/c'>c</a></span>(<span class='kw'>base</span> <span class='kw'>=</span> <span class='fl'>1</span>, <span class='kw'>cl</span> <span class='kw'>=</span> <span class='fl'>1</span>, <span class='kw'>v</span> <span class='kw'>=</span> <span class='fl'>10</span>, <span class='kw'>ka</span> <span class='kw'>=</span> <span class='fl'>1</span>, <span class='kw'>keo</span> <span class='kw'>=</span> <span class='fl'>0.01</span>),
                          <span class='kw'>problem</span> <span class='kw'>=</span> <span class='st'>"True Model"</span>,
                          <span class='kw'>reference</span> <span class='kw'>=</span> <span class='fl'>4</span>)</div><div class='output co'>#&gt; <span class='error'>Error in nlme.formula(model = value ~ base + EFF.1comp.1abs(dose, time,     cl * exp(cl.eta), v, ka, keo), data = pkpdData[pkpdData$type ==     "PD" &amp; pkpdData$dose &gt; 0 &amp; pkpdData$value &gt; 0.5, ], fixed = base +     cl + v + ka + keo ~ 1, random = cl.eta ~ 1, groups = ~id,     start = c(base = 1, cl = 1, v = 10, ka = 1, keo = 0.01)): object 'pkpdData' not found</span></div><div class='input'><span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/summary'>summary</a></span>(<span class='no'>fit.PD004.nlme</span>$<span class='no'>object</span>)</div><div class='output co'>#&gt; <span class='error'>Error in summary(fit.PD004.nlme$object): object 'fit.PD004.nlme' not found</span></div><div class='input'><span class='fu'>nlme.extract</span>(<span class='no'>fit.PD004.nlme</span>$<span class='no'>object</span>)$<span class='no'>table</span></div><div class='output co'>#&gt; <span class='error'>Error in nlme.extract(fit.PD004.nlme$object): object 'fit.PD004.nlme' not found</span></div><div class='input'>
<span class='co'># simple fit vs time</span>
<span class='no'>fit.PD004.pred.nlme</span> <span class='kw'>=</span> <span class='fu'>nlme.predict</span>(<span class='kw'>func</span> <span class='kw'>=</span> <span class='no'>value</span> ~ <span class='no'>time</span> , <span class='no'>fit.PD004.nlme</span>$<span class='no'>object</span>)</div><div class='output co'>#&gt; <span class='error'>Error in getData(object): object 'fit.PD004.nlme' not found</span></div><div class='input'><span class='fu'>plot.fit</span>(<span class='no'>fit.PD004.pred.nlme</span>)</div><div class='output co'>#&gt; <span class='error'>Error in plot.fit(fit.PD004.pred.nlme): object 'fit.PD004.pred.nlme' not found</span></div><div class='input'><span class='no'>fit.PD004.pred.nlme</span> <span class='kw'>=</span> <span class='fu'>nlme.predict</span>(<span class='kw'>func</span> <span class='kw'>=</span> <span class='no'>value</span> ~ <span class='no'>time</span> , <span class='no'>fit.PD004.nlme</span>$<span class='no'>object</span>, <span class='kw'>method</span> <span class='kw'>=</span> <span class='st'>"partial.residuals"</span>)</div><div class='output co'>#&gt; <span class='error'>Error in getData(object): object 'fit.PD004.nlme' not found</span></div><div class='input'><span class='fu'>plot.fit</span>(<span class='no'>fit.PD004.pred.nlme</span>) <span class='co'>## this is the same: PARTIAL RESIDUALS</span></div><div class='output co'>#&gt; <span class='error'>Error in plot.fit(fit.PD004.pred.nlme): object 'fit.PD004.pred.nlme' not found</span></div><div class='input'><span class='no'>fit.PD004.pred.nlme</span> <span class='kw'>=</span> <span class='fu'>nlme.predict</span>(<span class='kw'>func</span> <span class='kw'>=</span> <span class='no'>value</span> ~ <span class='no'>time</span> , <span class='no'>fit.PD004.nlme</span>$<span class='no'>object</span>, <span class='kw'>method</span> <span class='kw'>=</span> <span class='st'>"prediction"</span>)</div><div class='output co'>#&gt; <span class='error'>Error in getData(object): object 'fit.PD004.nlme' not found</span></div><div class='input'><span class='fu'>plot.fit</span>(<span class='no'>fit.PD004.pred.nlme</span>) <span class='co'>## now we get simply the prediction for all xCovariate</span></div><div class='output co'>#&gt; <span class='error'>Error in plot.fit(fit.PD004.pred.nlme): object 'fit.PD004.pred.nlme' not found</span></div><div class='input'>
<span class='co'>## note that prediction and partial residual type of model fit plots are very different</span>

<span class='co'># fit vs time by dose</span>
<span class='no'>fit.PD004.pred.nlme</span> <span class='kw'>=</span> <span class='fu'>nlme.predict</span>(<span class='kw'>func</span> <span class='kw'>=</span> <span class='no'>value</span> ~ <span class='no'>time</span> <span class='kw'>|</span> <span class='no'>dose</span>, <span class='no'>fit.PD004.nlme</span>$<span class='no'>object</span>)</div><div class='output co'>#&gt; <span class='error'>Error in getData(object): object 'fit.PD004.nlme' not found</span></div><div class='input'><span class='fu'>plot.fit</span>(<span class='no'>fit.PD004.pred.nlme</span>)</div><div class='output co'>#&gt; <span class='error'>Error in plot.fit(fit.PD004.pred.nlme): object 'fit.PD004.pred.nlme' not found</span></div><div class='input'><span class='no'>fit.PD004.pred.nlme</span> <span class='kw'>=</span> <span class='fu'>nlme.predict</span>(<span class='kw'>func</span> <span class='kw'>=</span> <span class='no'>value</span> ~ <span class='no'>time</span> <span class='kw'>|</span> <span class='no'>dose</span>, <span class='no'>fit.PD004.nlme</span>$<span class='no'>object</span>, <span class='kw'>method</span> <span class='kw'>=</span> <span class='st'>"residuals"</span>)</div><div class='output co'>#&gt; <span class='error'>Error in getData(object): object 'fit.PD004.nlme' not found</span></div><div class='input'><span class='fu'>plot.fit</span>(<span class='no'>fit.PD004.pred.nlme</span>, <span class='kw'>yLimits</span> <span class='kw'>=</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/c'>c</a></span>(-<span class='fl'>1</span>,<span class='fl'>1</span>))</div><div class='output co'>#&gt; <span class='error'>Error in plot.fit(fit.PD004.pred.nlme, yLimits = c(-1, 1)): object 'fit.PD004.pred.nlme' not found</span></div><div class='input'><span class='fu'>plot.fit</span>(<span class='no'>fit.PD004.pred.nlme</span>, <span class='kw'>yLimits</span> <span class='kw'>=</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/c'>c</a></span>(-<span class='fl'>1</span>,<span class='fl'>1</span>), <span class='kw'>abline</span> <span class='kw'>=</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/list'>list</a></span>(<span class='kw'>h</span> <span class='kw'>=</span> <span class='fl'>0</span>, <span class='kw'>lty</span><span class='kw'>=</span><span class='fl'>2</span>))</div><div class='output co'>#&gt; <span class='error'>Error in plot.fit(fit.PD004.pred.nlme, yLimits = c(-1, 1), abline = list(h = 0,     lty = 2)): object 'fit.PD004.pred.nlme' not found</span></div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      
      <li><a href="#value">Value</a></li>
      
      <li><a href="#examples">Examples</a></li>
    </ul>

  </div>
</div>

      <footer>
      <div class="copyright">
  <p>Developed by Jason Chittenden, Klaas Prins, Lee Hodge <lee.hodge@qpharmetra.com.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
   </div>

  

  </body>
</html>

